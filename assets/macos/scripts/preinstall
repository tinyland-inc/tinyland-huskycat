#!/bin/bash
# SPDX-License-Identifier: Apache-2.0
# HuskyCat PKG pre-install script
# Runs before files are copied

set -e

echo "HuskyCat Pre-Install Check"
echo "=========================="

# Check macOS version (require 11.0+)
MACOS_VERSION=$(sw_vers -productVersion)
MAJOR_VERSION=$(echo "$MACOS_VERSION" | cut -d. -f1)

if [ "$MAJOR_VERSION" -lt 11 ]; then
    echo "Error: HuskyCat requires macOS 11.0 or later."
    echo "Current version: $MACOS_VERSION"
    exit 1
fi

echo "macOS version: $MACOS_VERSION (OK)"

# Check if previous version exists and backup config
HUSKYCAT_CONFIG="$HOME/.huskycat"
if [ -d "$HUSKYCAT_CONFIG" ]; then
    echo "Found existing configuration at $HUSKYCAT_CONFIG"
    # Config is preserved, no action needed
fi

# Check for existing binary
if command -v huskycat &> /dev/null; then
    EXISTING_VERSION=$(huskycat --version 2>/dev/null || echo "unknown")
    echo "Existing HuskyCat installation found: $EXISTING_VERSION"
    echo "Will be upgraded."
fi

echo ""
echo "Pre-install checks passed."
exit 0
